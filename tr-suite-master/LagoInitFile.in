nat-settings: &nat-settings
    type: nat
    dhcp:
      start: 100
      end: 254
    management: False

vm-common-settings: &vm-common-settings
    root-password: 123456
    service_provider: systemd

domains:
  ost-{{ env.suite_name }}-engine:
    <<: *vm-common-settings
    vm-type: default
    memory: 8196
    nics:
      - net: lago-{{ env.suite_name}}-net-management
      - net: lago-{{ env.suite_name}}-net-storage
    disks:
      - type: template
        template_type: qcow2
        path: {{ env.engine_installed_image }}
        name: root
        dev: vda
        format: qcow2
      - comment: Main NFS device
        size: 101G
        type: empty
        name: nfs
        dev: sda
        format: raw
      - comment: Main iSCSI device
        size: 105G
        type: empty
        name: iscsi
        dev: sdc
        format: raw
      - comment: Additional swap
        size: 4G
        type: empty
        name: swap
        dev: sdb
        format: raw
    metadata:
      ovirt-engine-password: 123
      deploy-scripts:
        - common/deploy-scripts/setup_storage.sh
        - common/deploy-scripts/setup_engine.sh
        - common/deploy-scripts/test-extend-swap.sh
{%- for i in range(hostCount) %}
  ost-{{ env.suite_name }}-host-{{ i }}:
    <<: *vm-common-settings
    vm-type: default
    memory: 12292
    vcpu: 4
    nics:
      - net: lago-{{ env.suite_name }}-net-management
      - net: lago-{{ env.suite_name }}-net-storage
      - net: lago-{{ env.suite_name }}-net-bonding
      - net: lago-{{ env.suite_name }}-net-bonding
    disks:
      - type: template
        template_type: qcow2
        path: {{ env.host_installed_image }}
        name: root
        dev: vda
        format: qcow2

    metadata:
      deploy-scripts:
        - common/deploy-scripts/setup_host.sh
{%- endfor %}
nets:
  lago-{{ env.suite_name }}-net-management:
    <<: *nat-settings
    management: true
    dns_domain_name: lago.local
  lago-{{ env.suite_name }}-net-bonding:
    <<: *nat-settings
  lago-{{ env.suite_name }}-net-storage:
    <<: *nat-settings
